<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ask Odin | Valhalla AI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Fonts: Montserrat (clean), UnifrakturCook (Norse accent) -->
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', 'Georgia', serif;
      background: radial-gradient(ellipse 100% 65% at 50% 0%, #f5f8fa 75%, #dde4ee 100%);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }
    body::before {
      content: "";
      position: fixed;
      z-index: 0;
      left: 0; top: 0; right: 0; bottom: 0;
      background: url('https://www.transparenttextures.com/patterns/clouds.png');
      opacity: 0.12;
      filter: blur(1.5px);
      pointer-events: none;
    }
    .chat-wrapper {
      max-width: 900px;
      width: 98vw;
      margin: 62px auto 38px auto;
      background: rgba(255,255,255,0.92);
      border-radius: 2.2em;
      box-shadow: 0 12px 52px 0 #313e5b23, 0 1.5px 32px #a0b8d144, 0 2px 28px 0 #0001;
      padding: 2.3em 2.6em 2.1em 2.6em;
      border: 2.5px solid #e3e7ee;
      backdrop-filter: blur(7px) saturate(1.16);
      transition: box-shadow 0.55s cubic-bezier(.17,.67,.83,.67), transform 0.5s cubic-bezier(.12,.57,.88,1.18);
      position: relative;
    }
    .chat-wrapper:hover, .chat-wrapper:focus-within {
      box-shadow: 0 28px 68px 0 #53587838, 0 1.5px 32px #bcc9dc66, 0 2px 32px 0 #2330531c, 0 8px 62px 8px #b3c5d412;
      transform: translateY(-8px) scale(1.018);
    }
    /* HEADER LAYOUT */
    .valhalla-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 28px;
      margin-bottom: 0.7em;
      position: relative;
    }
    .valhalla-logo {
      width: 56px; height: 56px;
      border-radius: 50%;
      background: #232528;
      border: 3.5px solid #bfa768;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 1px 8px #bfa76866, 0 0.5px 2.5px #23252844;
      margin-right: 12px;
    }
    .valhalla-logo img {
      width: 93%;
      height: 93%;
      object-fit: contain;
      border-radius: 50%;
    }
    .header-title {
      text-align: center;
      font-family: 'Montserrat', sans-serif;
      font-size: 2.3em;
      letter-spacing: 1.2px;
      color: #16171c;
      font-weight: 700;
      margin: 0 8px 0 8px;
      position: relative;
      z-index: 2;
    }
    .norse-underline {
      width: 88px;
      height: 5px;
      margin: -18px auto 28px auto;
      background: linear-gradient(to right, #5b607a 30%, #bfc9de 100%);
      border-radius: 2.5px;
      filter: blur(0.4px);
      box-shadow: 0 0 14px #e5e8ed4b, 0 0 2px #21273320;
      opacity: 0.74;
    }
    .valhalla-icons {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 16px;
    }
    .rune-svg {
      width: 36px;
      height: 36px;
      opacity: 0.86;
    }
    .raven-svg {
      width: 37px;
      height: 37px;
      margin-left: 2px;
      opacity: 0.86;
    }
    /* LOADER */
    #loader {
      display: none;
      text-align: center;
      margin: 1.15em 0 1.12em 0;
      color: #5b607a;
      font-style: italic;
      font-size: 1.13em;
      font-family: 'Montserrat', serif;
      letter-spacing: 0.02em;
      transition: opacity 0.34s;
    }
    .loader-rune {
      display: inline-block;
      font-family: 'UnifrakturCook', serif;
      font-size: 2em;
      color: #5b607a;
      margin-right: 9px;
      vertical-align: middle;
      filter: drop-shadow(0 0 8px #bfc5da77);
      animation: runespin 2.1s linear infinite;
    }
    @keyframes runespin {
      0% { transform: rotateY(0);}
      80% { filter: drop-shadow(0 0 16px #bfc5da44);}
      100% { transform: rotateY(360deg);}
    }
    .loader-dots::after {
      content: '';
      display: inline-block;
      width: 1em;
      text-align: left;
      animation: ellipsis steps(4,end) 1.18s infinite;
    }
    @keyframes ellipsis {
      to { width: 4em; }
    }
    /* CHAT */
    .chat-box {
      height: 480px;
      overflow-y: auto;
      border-radius: 1.5em;
      padding: 1.3em 1.8em 1.5em 1.3em;
      background: rgba(246,247,250,0.98);
      margin-bottom: 1.8em;
      box-shadow: 0 0 14px #bfc5da11, 0 0.5px 10px #7a7b8b13;
      border: 1.5px solid #e0e0ec;
      scroll-behavior: smooth;
      position: relative;
      transition: box-shadow 0.4s;
    }
    .msg {
      opacity: 0;
      animation: fadeIn 0.5s forwards;
      margin-bottom: 1.06em;
    }
    @keyframes fadeIn {
      from { opacity: 0;}
      to   { opacity: 1;}
    }
    .msg.user {
      color: #232528;
      background: linear-gradient(98deg, #f7f7f7 80%, #d9dde3 100%);
      border-radius: 10px 22px 16px 10px;
      padding: 0.85em 1.38em 0.88em 1.21em;
      font-weight: bold;
      margin: 0.7em 0 0.7em 35%;
      border-left: 3px solid #bfc5da;
      box-shadow: 1px 2px 14px #bfc5da13;
      word-break: break-word;
      font-size: 1.09em;
    }
    .msg.odin {
      color: #232528;
      background: linear-gradient(99deg, #fcfcfd 93%, #ececf1 100%);
      font-style: italic;
      border-left: 5.5px solid #a4311c;
      padding: 1.11em 1.21em 1.08em 1.38em;
      margin: 0.7em 31% 0.7em 0;
      border-radius: 22px 13px 13px 26px;
      box-shadow: 2px 4px 24px #bfc5da1a;
      word-break: break-word;
      font-size: 1.12em;
      position: relative;
      overflow: visible;
      transition: box-shadow 0.6s;
    }
    /* Fog effect (for Odin replies) */
    .msg.odin:hover::before {
      content: '';
      pointer-events: none;
      position: absolute;
      left: -10%; right: -10%; top: -12%; bottom: -10%;
      z-index: 2;
      background: radial-gradient(circle at 60% 60%, #dce0ea44 36%, #f7fafb11 90%);
      opacity: 0.89;
      animation: fog-move 2.2s linear infinite alternate;
      filter: blur(12px) brightness(1.15);
    }
    @keyframes fog-move {
      from { background-position: 60% 60%;}
      to   { background-position: 40% 40%;}
    }
    .msg.odin h1, .msg.odin h2, .msg.odin h3, .msg.odin h4, .msg.odin h5, .msg.odin h6 {
      font-family: 'UnifrakturCook', serif;
      color: #a4311c;
      letter-spacing: 0.7px;
      margin: 0.77em 0 0.36em 0;
      text-shadow: 0 0 7px #e1e4ed19;
      font-weight: 700;
    }
    .msg.odin ul, .msg.odin ol {
      margin: 0.85em 0 0.85em 1.8em;
    }
    .msg.odin strong {
      color: #a4311c;
      font-weight: 700;
      text-shadow: 0 0 4px #adadc744;
    }
    .msg.odin em {
      color: #232528;
      font-style: italic;
    }
    .input-area {
      display: flex;
      gap: 1em;
      margin-top: 0.9em;
      align-items: center;
    }
    .input-area input {
      flex: 1;
      padding: 1.14em;
      font-size: 1.13em;
      border: 2.2px solid #bfc5da;
      border-radius: 15px;
      background: #f6f8fa;
      outline: none;
      transition: border 0.23s, box-shadow 0.3s;
      box-shadow: 0 1.5px 10px #bfc5da19;
    }
    .input-area input:focus {
      border: 2.7px solid #232528;
      box-shadow: 0 0 9px #adadc7;
    }
    .input-area button {
      padding: 1.14em 2.1em;
      font-size: 1.15em;
      background: linear-gradient(to right, #232528, #bfc5da);
      color: #fff;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 1.5px 10px #bfc5da19;
      letter-spacing: 0.09em;
      transition: background 0.3s, box-shadow 0.3s;
      font-family: inherit;
    }
    .input-area button:hover {
      background: linear-gradient(to right, #363b47, #f6f6f6 100%);
      box-shadow: 0 6px 16px #adadc7a1;
      color: #232528;
    }
    @media (max-width: 700px) {
      .chat-wrapper { padding: 0.7em 1vw;}
      .chat-box { height: 250px;}
      .valhalla-header { gap: 14px;}
      .valhalla-logo, .rune-svg, .raven-svg { width: 35px; height: 35px;}
      h1 { font-size: 1.38em;}
      .norse-underline { width: 48px;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="chat-wrapper">
    <div class="valhalla-header">
      <!-- Odin Medallion Logo (left) -->
      <span class="valhalla-logo">
        <img src="https://valhallasedge.com/cdn/shop/files/Odin_logo_gold.png" alt="Odin Medallion" loading="lazy" />
        <!-- Swap above link to your production asset as needed -->
      </span>
      <span class="header-title">Ask Odin</span>
      <!-- Right: Runic symbol and Raven SVG -->
      <span class="valhalla-icons">
        <!-- Rune SVG (Ansuz rune for Odin) -->
        <svg class="rune-svg" viewBox="0 0 48 48" fill="none"><path d="M13 41V7M13 24l21-13.5M13 24l19.5 14" stroke="#bfc5da" stroke-width="4" stroke-linecap="round"/></svg>
        <!-- Raven SVG (Minimal style) -->
        <svg class="raven-svg" viewBox="0 0 50 50" fill="none"><path d="M8 36Q16 18 40 15Q28 20 31 25Q32 29 41 29Q33 31 23 44Q26 34 13 34Q17 29 27 28Q17 22 8 36Z" stroke="#a3adc4" stroke-width="2.2" fill="#c4cadb" opacity="0.92"/><circle cx="35" cy="18" r="1.5" fill="#232528"/></svg>
      </span>
    </div>
    <div class="norse-underline"></div>
    <div id="chat" class="chat-box"></div>
    <div id="loader">
      <span class="loader-rune">áš¨</span>
      Odin is searching the Well of Wisdom<span class="loader-dots">...</span>
    </div>
    <div class="input-area">
      <input id="user-input" type="text" placeholder="Ask your question..." onkeydown="if(event.key==='Enter'){sendMessage()}" autocomplete="off" />
      <button onclick="sendMessage()">SEND</button>
    </div>
  </div>
<script>
  async function sendMessage() {
    const input = document.getElementById('user-input');
    const chat = document.getElementById('chat');
    const loader = document.getElementById('loader');
    const userText = input.value.trim();
    if (!userText) return;

    // Always use a new thread (no memory)
    let threadId = null;
    localStorage.removeItem('odinThreadId'); // just in case

    chat.innerHTML += `<div class="msg user">You: ${userText}</div>`;
    input.value = '';
    chat.scrollTop = chat.scrollHeight;

    // Show loader
    loader.style.display = 'block';

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ message: userText, threadId })
      });

      const data = await response.json();

      // Hide loader
      loader.style.display = 'none';

      if (data.reply) {
        chat.innerHTML += `<div class="msg odin">${marked.parse(data.reply)}</div>`;
      } else if (data.error) {
        chat.innerHTML += `<div class="msg odin">Odin: ERROR - ${data.error}</div>`;
      } else {
        chat.innerHTML += `<div class="msg odin">Odin: (No response from Valhalla...)</div>`;
      }
    } catch (err) {
      loader.style.display = 'none';
      console.error(err);
      chat.innerHTML += `<div class="msg odin">Odin: (NETWORK ERROR: ${err.message})</div>`;
    }

    chat.scrollTop = chat.scrollHeight;
  }
</script>
</body>
</html>
