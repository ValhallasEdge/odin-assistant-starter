<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Odin AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="OdinAI: Wisdom, legacy, and Norse myth for the modern world"/>
  <link rel="icon" href="https://cdn.shopify.com/s/files/1/0620/9958/7203/files/ChatGPT_Image_Jun_27_2025_02_47_18_PM.png?v=1751060934">
  <!-- Inter, Montserrat for modern/clean + Norse touch -->
  <link href="https://fonts.googleapis.com/css?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    html, body {
      background: radial-gradient(ellipse at center 30vh, #f8fafe 55%, #e6eaf3 100%);
      min-height: 100vh;
      font-family: 'Inter', 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #1b1c21;
    }
    body { overflow-x: hidden; }
    .odin-main {
      max-width: 540px;
      margin: 64px auto 0 auto;
      background: #fff;
      border-radius: 38px;
      box-shadow: 0 16px 64px #12204022, 0 1.5px 0 #e3d6b3 inset;
      position: relative;
      z-index: 2;
      padding: 48px 0 34px 0;
      animation: floatIn 1.2s cubic-bezier(.26,.87,.42,1.05);
    }
    @keyframes floatIn {
      0% { transform:translateY(60px) scale(.97); opacity:0; }
      80% { opacity:1; }
      100% { transform:translateY(0) scale(1); opacity:1; }
    }
    .odin-logo-wrap {
      text-align: center;
      margin-top: -88px;
      margin-bottom: 6px;
    }
    .odin-logo {
      width: 112px; height: 112px;
      border-radius: 50%;
      box-shadow: 0 3px 32px #0006;
      background: #18120e;
      border: 4px solid #d5ba7c;
      transition: box-shadow .3s;
      position: relative;
      z-index: 3;
      margin-bottom: 2px;
    }
    .odin-logo:hover {
      box-shadow: 0 8px 36px #000c, 0 0 28px #dbc07866;
      transition: box-shadow .19s;
    }
    .rune-bg {
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      text-align: center;
      color: #dbe0e6;
      font-size: 2.2rem;
      letter-spacing: 1.9rem;
      opacity: 0.19;
      font-weight: 900;
      margin-top: -24px;
      margin-bottom: 0;
      user-select:none;
      pointer-events:none;
      line-height: 2.5rem;
    }
    /* OdinAI Title */
    .odin-title {
      text-align: center;
      margin: 16px 0 0 0;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: 900;
      font-size: 3.2rem;
      letter-spacing: .14em;
      color: #18181b;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
      text-transform: uppercase;
    }
    .odin-o {
      display: inline-block;
      transition: color .24s;
      font-size: 2.99rem;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      color: #27397b;
      position: relative;
      cursor: pointer;
      width: 1.15em;
      text-align: center;
      user-select: none;
    }
    .odin-o .odin-o-rune {
      position: absolute; left:0; top:0;
      width:100%; height:100%;
      font-family: inherit;
      font-size: inherit;
      color: #b8a05d;
      opacity:0; pointer-events:none;
      transition: opacity .23s;
      text-shadow: 0 3px 10px #0005;
      letter-spacing: 0;
    }
    .odin-o:hover .odin-o-rune, .odin-o:focus .odin-o-rune { opacity:1; }
    .odin-o:hover .odin-o-base, .odin-o:focus .odin-o-base { opacity:0; }
    .odin-o .odin-o-base { opacity:1; transition: opacity .22s; }
    .odin-title-underline {
      margin: 0 auto 13px auto;
      display: block;
      width: 290px; height: 22px;
    }
    .odin-tagline {
      text-align: center;
      margin: 0 auto 30px auto;
      color: #787d85;
      font-size: 1.14rem;
      font-weight: 400;
      letter-spacing: .04em;
      font-family: 'Inter', Arial, sans-serif;
    }
    /* Chat container */
    .odin-chat-frame {
      width: 97%;
      margin: 0 auto;
      background: #f8fafdcc;
      border-radius: 18px;
      box-shadow: 0 2px 18px #adc7e213;
      border: 2.5px solid #e8e9ee;
      position: relative;
      padding: 0;
      margin-bottom: 28px;
      min-height: 200px;
      max-height: 410px;
      overflow-y: auto;
      transition: box-shadow .18s;
    }
    .odin-chat-frame:focus-within, .odin-chat-frame:hover {
      box-shadow: 0 8px 38px #27397b15;
      border-color: #aebbe2;
    }
    .odin-user-bubble {
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: 700;
      color: #27397b;
      background: #f6f9fc;
      border-left: 5px solid #769ad4;
      padding: 15px 20px 11px 18px;
      margin: 19px 0 6px 0;
      border-radius: 13px 18px 14px 17px;
      font-size: 1.18rem;
      max-width: 95%;
      box-shadow: 0 1px 7px #bbcee820;
    }
    .odin-ai-bubble {
      font-family: 'Georgia', 'serif';
      font-size: 1.1rem;
      background: #fafdff;
      color: #25231e;
      border-left: 5px solid #b8a05d;
      padding: 15px 24px 16px 22px;
      border-radius: 15px 16px 17px 16px;
      margin: 2px 0 22px 0;
      box-shadow: 0 2px 6px #e9e2be14;
      max-width: 99%;
      line-height: 1.64;
      word-break: break-word;
      transition: box-shadow .14s;
      font-variant-ligatures: common-ligatures;
      letter-spacing: .01em;
    }
    .odin-ai-bubble strong,
    .odin-ai-bubble .odin-heading {
      color: #314072;
      font-weight: bold;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      letter-spacing: .01em;
    }
    .odin-ai-bubble .odin-highlight {
      color: #314072;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: 800;
      letter-spacing: .03em;
      font-size: 1.07em;
      text-transform: uppercase;
    }
    .odin-ai-bubble em, .odin-ai-bubble .odin-pop {
      color: #7e8ec2;
      font-style: italic;
      font-family: 'Inter', Arial, sans-serif;
      font-size: 1.02em;
    }
    .odin-ai-bubble .odin-legacy {
      color: #b8a05d;
      font-weight: bold;
    }
    .odin-ai-bubble .odin-rune {
      font-family: 'Montserrat', Arial, sans-serif;
      letter-spacing: 0.13em;
      color: #adc;
      font-size: 1.09em;
    }
    /* Loader */
    .odin-loader {
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      color: #b8a05d;
      font-size: 1.14rem;
      margin: 16px 0 8px 0;
      font-weight: bold;
      min-height: 32px;
      letter-spacing: .04em;
      user-select:none;
      gap: 8px;
      opacity: .96;
    }
    .rune-spin {
      animation: spin 1.7s linear infinite;
      font-size: 1.68em;
      margin-right: 7px;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    /* Input area */
    .input-area {
      width: 95%;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .input-area input[type="text"] {
      flex: 1;
      padding: 1.17em 1em 1.17em 1.14em;
      border: 2px solid #d5d9e6;
      border-radius: 13px;
      font-size: 1.17rem;
      font-family: 'Inter', Arial, sans-serif;
      outline: none;
      transition: border .17s, box-shadow .12s;
      background: #fafdff;
      color: #1a1a1c;
      box-shadow: 0 1px 6px #c7d0e544 inset;
    }
    .input-area input[type="text"]:focus {
      border-color: #7e8ec2;
      box-shadow: 0 2px 14px #adc7e216;
    }
    .input-area button {
      background: linear-gradient(90deg, #5373ad 5%, #e6eaf3 97%);
      color: #fff;
      border: none;
      border-radius: 13px;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: bold;
      font-size: 1.18rem;
      padding: 1em 2.35em;
      box-shadow: 0 2px 12px #adc7e235;
      cursor: pointer;
      transition: box-shadow .18s, background .17s;
      letter-spacing: .07em;
      outline: none;
      display: flex;
      align-items: center;
      gap: 4px;
      position: relative;
    }
    .input-area button:hover {
      background: linear-gradient(90deg, #e6eaf3 0%, #5373ad 90%);
      box-shadow: 0 7px 18px #31407219;
    }
    .audio-toggle {
      background: none;
      border: none;
      color: #314072;
      font-size: 1.9em;
      margin-left: 8px;
      cursor: pointer;
      opacity: 0.73;
      transition: opacity .18s, color .18s;
      outline: none;
      padding: 0;
      line-height: 1;
    }
    .audio-toggle[aria-pressed="true"] { color: #b8a05d; opacity:1;}
    .audio-toggle:hover, .audio-toggle:focus { opacity: 1; color: #b8a05d; }
    .volume-slider {
      width: 80px; height: 3px;
      accent-color: #b8a05d;
      vertical-align: middle;
      margin-left: 7px;
      border-radius: 6px;
      cursor: pointer;
      background: #e0e4ed;
    }
    /* Footer */
    .valhalla-footer {
      text-align: center;
      color: #b8a05d;
      margin: 33px auto 0 auto;
      font-size: 1.07rem;
      letter-spacing: .04em;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      opacity: .79;
      padding-bottom: 18px;
    }
    .valhalla-badge {
      background: #f4eacb;
      color: #314072;
      font-weight: bold;
      border-radius: 7px;
      padding: 2px 13px;
      margin-left: 4px;
      font-size: 1.05em;
      letter-spacing: .06em;
      border: 1.4px solid #dac273;
      box-shadow: 0 2px 7px #dac27333;
      vertical-align: middle;
      display: inline-block;
    }
    @media (max-width: 850px) {
      .odin-main { max-width:99vw; border-radius:16px; padding-top:28px; }
      .odin-logo { width: 75px; height: 75px; }
      .odin-title { font-size: 1.8rem;}
      .odin-title-underline { width: 110px;}
      .rune-bg {font-size:1.04rem;}
      .odin-chat-frame {max-height:220px;}
      .odin-ai-bubble { font-size:1.01rem;}
      .odin-user-bubble { font-size:.98rem;}
      .valhalla-footer { font-size: .92rem;}
    }
  </style>
</head>
<body>
  <div class="odin-main">
    <div class="odin-logo-wrap">
      <img src="https://cdn.shopify.com/s/files/1/0620/9958/7203/files/ChatGPT_Image_Jun_27_2025_02_47_18_PM.png?v=1751060934" class="odin-logo" alt="Odin Norse AI Logo" draggable="false" />
    </div>
    <div class="rune-bg" aria-hidden="true">
      ᚠᚱᚾᛊ ᚠᛁ ᚱᛉᚱ ᛗᚾᛉ
    </div>
    <div class="odin-title">
      ASK
      <span class="odin-o" tabindex="0">
        <span class="odin-o-base">O</span>
        <span class="odin-o-rune" aria-hidden="true">ᛟ</span>
      </span>
      DIN
    </div>
    <svg class="odin-title-underline" viewBox="0 0 295 20" fill="none">
      <path d="M12 10 H282" stroke="#b8a05d" stroke-width="4" stroke-linecap="round"/>
      <polygon points="282,10 271,4 271,16" fill="#b8a05d"/>
      <circle cx="12" cy="10" r="3.7" fill="#b8a05d"/>
    </svg>
    <div class="odin-tagline">Wisdom, legacy, and Norse myth for the modern world</div>
    <div class="odin-chat-frame" id="chat" aria-live="polite" aria-atomic="false"></div>
    <div class="odin-loader" id="odin-loader" style="display:none;">
      <span class="rune-spin">ᚨ</span>
      Odin is consulting the Well of Wisdom...
    </div>
    <form class="input-area" autocomplete="off" onsubmit="sendMessage();return false;">
      <input id="user-input" type="text" maxlength="600" placeholder="Ask your question..." aria-label="Type your question"/>
      <button type="submit"><span class="material-icons" style="vertical-align:middle;">send</span> SEND</button>
      <span id="audioToggle" class="audio-toggle material-icons" title="Toggle ambience" tabindex="0" role="button" aria-pressed="false">volume_up</span>
      <input type="range" min="0" max="1" step="0.01" id="volumeSlider" class="volume-slider" value="0.3" title="Music volume">
    </form>
    <audio id="odinAudio" loop preload="auto" style="display:none">
      <!-- You can change this to any royalty-free ambience/meditation music you like -->
      <source src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b7c40106.mp3" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
    <div class="valhalla-footer">
      Powered by <span class="valhalla-badge">Valhalla’s Edge</span>
    </div>
  </div>
  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('user-input');
    const loader = document.getElementById('odin-loader');

    // Utility: scroll to latest
    function scrollChat() {
      chat.scrollTop = chat.scrollHeight;
    }

    // Add chat bubbles
    function addMsg(msg, who="odin") {
      let el = document.createElement('div');
      el.className = (who==="user") ? "odin-user-bubble" : "odin-ai-bubble";
      el.innerHTML = msg;
      chat.appendChild(el);
      scrollChat();
    }

    // Basic markdown and Norse formatting parser
    function parseOdin(text) {
      // Headings/lines: Odin mode
      text = text.replace(/^\s*(THE MYTH|THE MESSAGE|THE MOVE|THE LEGACY|LEGACY ECHO|THE SAGA)\s*:?/gm,
        `<span class="odin-highlight">$1</span>`);
      // Strong
      text = text.replace(/\*\*(.*?)\*\*/g, `<strong>$1</strong>`);
      // Pop terms (italic/em)
      text = text.replace(/\*(.*?)\*/g, `<em class="odin-pop">$1</em>`);
      // Legacy echo/highlighted words
      text = text.replace(/\b(legacy|echo|wisdom|truth)\b/gi, `<span class="odin-legacy">$1</span>`);
      // Runes (between backticks)
      text = text.replace(/`([ᚠ-ᛟ]{2,})`/g, `<span class="odin-rune">$1</span>`);
      // Bullets
      text = text.replace(/^\s*[\-\*] (.+)$/gm, '<li>$1</li>');
      // Blockquotes
      text = text.replace(/^\s*\>\s?(.*)$/gm, '<blockquote>$1</blockquote>');
      // Line breaks
      text = text.replace(/\n{2,}/g, '<br><br>');
      return text;
    }

    // Loader with animated runes
    const runes = ['ᚠ','ᚢ','ᚦ','ᚨ','ᚱ','ᚲ','ᚷ','ᚹ','ᚺ','ᚾ','ᛁ','ᛃ','ᛇ','ᛈ','ᛉ','ᛋ','ᛏ','ᛒ','ᛖ','ᛗ','ᛚ','ᛜ','ᛞ','ᛟ'];
    let runeInterval, runeIdx=0;
    function showLoader() {
      loader.style.display = "flex";
      runeIdx=0;
      loader.querySelector('.rune-spin').textContent = runes[0];
      runeInterval = setInterval(()=>{
        runeIdx = (runeIdx+1)%runes.length;
        loader.querySelector('.rune-spin').textContent = runes[runeIdx];
      }, 155);
    }
    function hideLoader() {
      loader.style.display = "none";
      if(runeInterval) clearInterval(runeInterval);
    }

    // Chat submission
    async function sendMessage() {
      const userText = input.value.trim();
      if (!userText) return;
      addMsg("You: <b>" + userText + "</b>", "user");
      input.value = '';
      showLoader();
      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ message: userText, threadId: null })
        });
        const data = await response.json();
        hideLoader();
        if (data.reply) {
          addMsg("Odin: " + parseOdin(data.reply), "odin");
        } else if (data.error) {
          addMsg(`<span style="color:#a21927;">ERROR: ${data.error}</span>`, "odin");
        } else {
          addMsg(`<span style="color:#ad4d24;">(No response from Valhalla...)</span>`, "odin");
        }
      } catch (err) {
        hideLoader();
        addMsg(`<span style="color:#ad4d24;">(NETWORK ERROR: ${err.message})</span>`, "odin");
      }
    }

    // Enter key
    input.addEventListener('keydown', function(e){
      if (e.key === 'Enter') { e.preventDefault(); sendMessage(); }
    });

    // Odin O hover rune swap (accessible)
    document.querySelector('.odin-o').addEventListener('mouseenter',function(){
      this.querySelector('.odin-o-rune').style.opacity=1;
      this.querySelector('.odin-o-base').style.opacity=0;
    });
    document.querySelector('.odin-o').addEventListener('mouseleave',function(){
      this.querySelector('.odin-o-rune').style.opacity=0;
      this.querySelector('.odin-o-base').style.opacity=1;
    });
    document.querySelector('.odin-o').addEventListener('focus',function(){
      this.querySelector('.odin-o-rune').style.opacity=1;
      this.querySelector('.odin-o-base').style.opacity=0;
    });
    document.querySelector('.odin-o').addEventListener('blur',function(){
      this.querySelector('.odin-o-rune').style.opacity=0;
      this.querySelector('.odin-o-base').style.opacity=1;
    });

    // Audio: music/ambience controls
    const audio = document.getElementById('odinAudio');
    const audioToggle = document.getElementById('audioToggle');
    const volumeSlider = document.getElementById('volumeSlider');
    let audioOn = false;
    audioToggle.onclick = function(){
      audioOn = !audioOn;
      audioToggle.setAttribute('aria-pressed', audioOn ? "true" : "false");
      if(audioOn) { audio.volume=volumeSlider.value; audio.play(); }
      else audio.pause();
    };
    audioToggle.addEventListener('keydown',function(e){
      if(e.key==='Enter'||e.key===' '){audioToggle.click();}
    });
    volumeSlider.oninput = function() {
      audio.volume = this.value;
    };

    // Mobile autofocus hack
    window.onload = () => { setTimeout(()=>input.focus(),120); };
  </script>
</body>
</html>
