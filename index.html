<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ASK ODIN | Valhalla's Edge</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Ask Odin, Norse AI for wisdom and legacy advice—powered by Valhalla's Edge." />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --charcoal: #1c1e21;
      --charcoal-light: #32343a;
      --mist-bg: #f7f8fa;
      --soft-gray: #eceef2;
      --rune-blue: #425174;
      --norse-red: #972821;
      --body-gray: #44464c;
      --input-focus: #425174;
      --gold: #c1a355;
      --box-radius: 2.4em;
    }
    html, body {
      min-height: 100vh;
      margin: 0; padding: 0;
      font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, var(--mist-bg) 70%, #e2e5ed 100%);
      color: var(--charcoal);
    }
    body::before {
      content: "";
      position: fixed; inset: 0;
      background: url('https://www.transparenttextures.com/patterns/clouds.png'), linear-gradient(115deg, #f3f4f7 70%, #e6e8f0 100%);
      opacity: 0.14; filter: blur(1px);
      pointer-events: none; z-index: 0;
    }
    .chat-wrapper {
      max-width: 730px;
      margin: 60px auto 36px auto;
      background: rgba(255,255,255,0.97);
      border-radius: var(--box-radius);
      box-shadow: 0 12px 44px #2a314214, 0 2px 12px #d9b77d33;
      padding: 2.5em 2.3em 2em 2.3em;
      border: 1.6px solid var(--soft-gray);
      position: relative; z-index: 1;
    }
    /* LOGO & HEADER */
    .valhalla-header {
      display: flex; flex-direction: column; align-items: center;
      margin-bottom: 0.5em;
      position: relative;
    }
    .odin-logo {
      width: 128px; height: 128px; /* Double size */
      border-radius: 50%;
      background: #18191a;
      box-shadow: 0 3px 18px #ad8f42aa, 0 2px 8px #bfa76844;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 8px; border: 3.2px solid var(--gold);
      overflow: hidden;
      z-index: 2;
      transition: box-shadow 0.25s;
    }
    .odin-logo img {
      width: 98%; height: 98%;
      object-fit: contain;
      border-radius: 50%;
      display: block;
    }
    /* Large, wide faded runes BG */
    .runes-bg.runes-wide {
      top: 0px; left: 50%; width: 100%;
      transform: translateX(-50%);
      font-family: 'UnifrakturCook', serif;
      font-size: 2.5em;
      opacity: 0.13;
      text-align: center;
      letter-spacing: 0.46em;
      white-space: nowrap;
      pointer-events: none;
      z-index: 1;
      position: absolute;
      user-select: none;
    }
    .header-title.ask-odin {
      font-size: 3.3em;
      font-weight: 900;
      text-transform: uppercase;
      color: var(--charcoal);
      letter-spacing: 0.04em;
      margin: 0 0 0.07em 0;
      text-align: center;
      position: relative;
      z-index: 2;
      line-height: 1.13;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.17em;
      font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
    }
    .odin-runic .odin-letter {
      font-family: 'UnifrakturCook', serif;
      color: var(--norse-red);
      font-size: 1.12em;
      display: inline-block;
      vertical-align: baseline;
      letter-spacing: -0.03em;
      font-weight: 900;
      margin-right: -0.07em;
    }
    .odin-runic {
      font-weight:900; letter-spacing:0.07em;
    }
    /* SVG Arrow Underline */
    .odin-arrow-underline {
      display: block;
      margin: -12px auto 22px auto;
      max-width: 390px;
      min-width: 190px;
      width: 85%;
      z-index: 3;
    }
    /* LOADER */
    #loader { display:none; text-align:center; margin:1.1em 0 1em 0; color: var(--rune-blue); font-size:1.09em;}
    .loader-rune {
      display:inline-block; font-family:'UnifrakturCook',serif;
      font-size:2em; color:var(--norse-red); margin-right:9px;
      filter: drop-shadow(0 0 6px #ad8f4299);
      animation:runespin 2.1s linear infinite;
    }
    @keyframes runespin {0%{transform:rotateY(0);}100%{transform:rotateY(360deg);}}
    .loader-dots::after {content:'';display:inline-block;width:1em;text-align:left;animation:ellipsis steps(4,end) 1.17s infinite;}
    @keyframes ellipsis { to { width: 4em; } }
    /* CHAT BOX */
    .chat-box {
      height: 410px; overflow-y:auto;
      border-radius: 1.4em; padding:1.18em 1.88em 1.1em 1.12em;
      background: var(--mist-bg);
      margin-bottom: 1.35em; box-shadow: 0 0 12px #c9ccd415;
      border: 1.2px solid var(--soft-gray);
      position: relative; font-size:1.11em; scroll-behavior:smooth;
      transition: box-shadow 0.38s;
    }
    .msg {opacity:0;animation:fadeIn 0.47s forwards; margin-bottom:1.03em;line-height:1.65;}
    @keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
    .msg.user {
      color: var(--charcoal);
      background: linear-gradient(97deg,#f7f7f7 80%,#e3e7ee 100%);
      border-radius: 11px 21px 16px 10px;
      padding: 0.75em 1.17em 0.95em 1.1em;
      font-weight: 700; margin:0.7em 0 0.7em 38%;
      border-left: 2.5px solid var(--rune-blue);
      box-shadow: 1px 2px 10px #ad8f4217;
      word-break:break-word;
    }
    .msg.odin {
      color: var(--body-gray);
      background: linear-gradient(100deg, #fcfcfe 95%, #f1f3f6 100%);
      border-left: 4px solid var(--norse-red);
      padding: 1.12em 1.15em 1.07em 1.15em;
      margin: 0.7em 26% 0.7em 0;
      border-radius: 19px 11px 12px 24px;
      box-shadow: 2px 4px 18px #bfa76817;
      font-size: 1.14em; font-family: 'Montserrat', serif;
      position: relative; overflow:visible; transition:box-shadow 0.48s;
    }
    .msg.odin h1, .msg.odin h2, .msg.odin h3, .msg.odin strong.section-title {
      font-family: 'Montserrat', serif; font-weight:700;
      margin:0.82em 0 0.45em 0; line-height:1.2;
      color: var(--charcoal-light); text-shadow:0 0 5px #d2d5db12;
    }
    .msg.odin h1.section-pop, .msg.odin h2.section-pop, .msg.odin h3.section-pop {
      color: var(--norse-red) !important;
      letter-spacing: 0.1em;
    }
    .msg.odin h4, .msg.odin h5, .msg.odin h6 { color: var(--rune-blue);}
    .msg.odin ul, .msg.odin ol {margin:0.79em 0 0.79em 2em;}
    .msg.odin strong { color: var(--charcoal); font-weight:700;}
    .msg.odin em { color: var(--norse-red); font-style:italic;}
    .msg.odin code {
      font-family:monospace;background:#ededf5;padding:2px 6px;
      border-radius:4px;color:var(--rune-blue);font-size:1em;
    }
    .msg.odin hr { border:none;border-top:1.2px solid #bfc5da3a;margin:1em 0;}
    .msg.odin a { color: var(--rune-blue); text-decoration: underline dotted;}
    .msg.odin a:hover { color: var(--norse-red);}
    .msg.odin:hover::before {
      content: '';
      pointer-events: none;
      position: absolute; left:-8%; right:-8%; top:-11%; bottom:-10%;
      z-index: 2;
      background: radial-gradient(circle at 58% 54%, #bfc5da25 42%, #fcfdfe0a 98%);
      opacity: 0.50;
      animation: fog-move 2.1s linear infinite alternate;
      filter: blur(7px) brightness(1.09);
    }
    @keyframes fog-move {from{background-position:52% 54%;}to{background-position:48% 44%;}}
    /* INPUT */
    .input-area {
      display: flex; gap: 1em; margin-top: 1.1em; align-items: center;
    }
    .input-area input {
      flex: 1; padding: 1.15em; font-size:1.13em;
      border: 2.2px solid #c1a355; border-radius: 14px;
      background: #f8f8fb; outline: none;
      color: var(--charcoal-light); font-weight: 400;
      transition: border 0.19s, box-shadow 0.23s;
      box-shadow: 0 1.5px 7px #ad8f4220;
    }
    .input-area input:focus {
      border: 2.8px solid var(--input-focus);
      box-shadow: 0 0 8px #bfa76829;
    }
    .input-area button {
      padding: 1.05em 2.1em; font-size:1.14em;
      background: linear-gradient(to right, var(--rune-blue), #c1a355);
      color: #fff; border: none; border-radius: 14px;
      cursor: pointer; font-weight: bold; font-family: inherit;
      box-shadow: 0 2px 12px #bfa76815;
      letter-spacing: 0.09em; transition: background 0.3s, box-shadow 0.3s;
    }
    .input-area button:hover {
      background: linear-gradient(to right, #363b47, #e5e6e8 100%);
      box-shadow: 0 6px 16px #adadc7a1;
      color: var(--charcoal);
    }
    @media (max-width: 700px) {
      .chat-wrapper {padding:0.7em 1vw;}
      .chat-box {height:240px;}
      .odin-logo {width:72px;height:72px;}
      .runes-bg.runes-wide {font-size:1.1em;}
      .header-title.ask-odin {font-size:1.05em;}
      .odin-arrow-underline {margin:-8px auto 12px auto;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="chat-wrapper">
    <div class="valhalla-header" style="position:relative;">
      <!-- Double-sized logo -->
      <span class="odin-logo">
        <img src="https://cdn.shopify.com/s/files/1/0620/9958/7203/files/ChatGPT_Image_Jun_27_2025_02_47_18_PM.png?v=1751060934" alt="Odin Medallion" loading="lazy" />
      </span>
      <!-- Large, wide faded runes BG -->
      <div class="runes-bg runes-wide">ᚨᚱᚢᛟ ᚨᛁ ᚱᚢᚾᛖᛋ ᚨᚱᚢᛟ</div>
      <!-- ASK ODIN, with runic "O" in ODIN -->
      <div class="header-title ask-odin">
        <span class="ask">ASK</span>
        <span class="odin-runic">
          <span class="odin-letter">O</span>DIN
        </span>
      </div>
      <!-- SVG Arrow Underline: spans ASK ODIN width -->
      <svg class="odin-arrow-underline" viewBox="0 0 380 16" width="100%" height="16">
        <line x1="15" y1="13" x2="365" y2="13" stroke="#c1a355" stroke-width="4" />
        <!-- Arrow head right -->
        <polygon points="365,8 380,13 365,18" fill="#c1a355" />
        <!-- Arrow tail left: Norse chevron -->
        <polyline points="15,13 26,5 22,13 26,21 15,13" fill="none" stroke="#c1a355" stroke-width="4" />
      </svg>
    </div>
    <div id="chat" class="chat-box" aria-live="polite"></div>
    <div id="loader">
      <span class="loader-rune">ᚨ</span>
      Odin is searching the Well of Wisdom<span class="loader-dots">...</span>
    </div>
    <div class="input-area">
      <input id="user-input" type="text" placeholder="Ask your question..." onkeydown="if(event.key==='Enter'){sendMessage()}" autocomplete="off" aria-label="Ask your question to Odin" />
      <button onclick="sendMessage()" aria-label="Send message to Odin">SEND</button>
    </div>
  </div>
<script>
  async function sendMessage() {
    const input = document.getElementById('user-input');
    const chat = document.getElementById('chat');
    const loader = document.getElementById('loader');
    const userText = input.value.trim();
    if (!userText) return;

    let threadId = null;
    localStorage.removeItem('odinThreadId');

    chat.innerHTML += `<div class="msg user">You: ${escapeHTML(userText)}</div>`;
    input.value = '';
    chat.scrollTop = chat.scrollHeight;
    loader.style.display = 'block';

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: userText, threadId })
      });
      const data = await response.json();
      loader.style.display = 'none';

      if (data.reply) {
        let html = marked.parse(data.reply);
        // Occasionally pop color for headings with special Norse or Odin terms:
        html = html.replace(/(<h[1-3]>)(.*\b(MYTH|MOVE|ODIN|LEGACY|SAGA|ANCESTRY|VISION)\b.*?)(<\/h[1-3]>)/gi, function(_, open, mid, close) {
          return open.replace(">", ' class="section-pop">') + mid + close;
        });
        chat.innerHTML += `<div class="msg odin">${html}</div>`;
      } else if (data.error) {
        chat.innerHTML += `<div class="msg odin">Odin: ERROR - ${escapeHTML(data.error)}</div>`;
      } else {
        chat.innerHTML += `<div class="msg odin">Odin: (No response from Valhalla...)</div>`;
      }
    } catch (err) {
      loader.style.display = 'none';
      chat.innerHTML += `<div class="msg odin">Odin: (NETWORK ERROR: ${escapeHTML(err.message)})</div>`;
    }
    chat.scrollTop = chat.scrollHeight;
  }
  function escapeHTML(str) {
    return (str || '').replace(/[&<>"']/g, function(m) {
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
    });
  }
</script>
</body>
</html>
