<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OdinAI ‚Äî Wisdom, Legacy, and Norse Myth for the Modern World</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Ask Odin: a cinematic, modern Norse wisdom assistant for legacy, motivation, and mythic guidance."/>
  <link rel="icon" type="image/png" href="https://cdn.shopify.com/s/files/1/0620/9958/7203/files/6efec50e-7164-40e4-9957-a95c6e0b487c.png?v=1751061405"/>
  <!-- Fonts: Modern geometric, with runic accent -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #181a20;
      --navy: #232a3b;
      --blue: #3a4d6a;
      --rune: #38537a;
      --accent: #a38424;
      --gold: #c9ab67;
      --runebg: #f8fafd;
      --ai-bg: #fcfcfa;
      --bubble: #f6f7fa;
      --shadow: 0 8px 40px 0 rgba(41,55,78,0.10);
      --highlight: #eaeaea;
      --send-bg: linear-gradient(90deg,#4b6584 30%, #a5aabf 100%);
      --send-bg-hover: linear-gradient(90deg,#38537a 10%, #b4b9d7 100%);
      --br: 22px;
      --transition: 0.28s cubic-bezier(.8,.4,.3,1);
      --mobile-p: 16px;
      --chat-w: 670px;
      --logo: 112px;
    }
    html, body {
      min-height: 100%;
      background: radial-gradient(ellipse 70% 70% at 50% 15%, #f7fafd 80%, #e5eaf3 100%);
      font-family: 'Outfit', 'Segoe UI', Arial, sans-serif;
      color: var(--primary);
      margin: 0; padding: 0;
      -webkit-font-smoothing: antialiased;
    }
    body {
      padding: 0;
      margin: 0;
    }
    .valhalla-main {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 40px 0 32px 0;
    }
    .odin-card {
      background: #fff;
      border-radius: var(--br);
      box-shadow: var(--shadow);
      width: min(96vw, var(--chat-w));
      max-width: 100%;
      padding: 0 0 32px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      margin-top: 0;
    }
    .odin-logo {
      width: var(--logo);
      height: var(--logo);
      object-fit: contain;
      display: block;
      margin: 0 auto -22px auto;
      z-index: 3;
      border-radius: 50%;
      box-shadow: 0 6px 24px 0 rgba(0,0,0,0.07);
      background: #fff;
      border: 3px solid #fff;
      position: relative;
      top: 34px;
      transition: transform .32s cubic-bezier(.7,.3,.1,1);
    }
    .odin-logo:hover, .odin-logo:focus {
      transform: scale(1.08) rotate(-2deg);
      box-shadow: 0 12px 42px 0 rgba(170,170,130,0.13);
    }
    .rune-banner {
      display: flex;
      justify-content: center;
      gap: 22px;
      opacity: 0.12;
      font-size: 2.2em;
      letter-spacing: .36em;
      margin: 0 0 -8px 0;
      user-select: none;
      width: 100%;
      font-family: 'Outfit', monospace;
      color: var(--navy);
    }
    .odin-header {
      margin-top: 36px;
      margin-bottom: 0;
      text-align: center;
      font-size: 2.7em;
      font-weight: 800;
      letter-spacing: 0.07em;
      position: relative;
      z-index: 2;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 0.07em;
      line-height: 1.02em;
      background: none;
      text-transform: uppercase;
    }
    .odin-o {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin: 0 -2px 0 -2px;
      transition: letter-spacing var(--transition);
      cursor: pointer;
      width: 1.1em;
      height: 1.1em;
      font-family: 'Outfit', Arial, sans-serif;
    }
    .odin-o-base {
      color: var(--blue);
      font-weight: 900;
      opacity: 1;
      transition: opacity 0.18s;
      font-size: 1.03em;
    }
    .odin-o-rune {
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      font-family: 'Noto Sans Runic', 'Outfit', Arial, sans-serif;
      color: var(--accent);
      opacity: 0;
      font-size: 1em;
      font-weight: 700;
      transition: opacity 0.18s;
      pointer-events: none;
    }
    .odin-o:hover .odin-o-base,
    .odin-o:focus .odin-o-base {
      opacity: 0;
    }
    .odin-o:hover .odin-o-rune,
    .odin-o:focus .odin-o-rune {
      opacity: 1;
    }
    .odin-underline {
      margin: 0.05em auto 0.11em auto;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 236px;
      max-width: 92vw;
      height: 15px;
      position: relative;
    }
    .odin-arrow {
      width: 100%;
      height: 12px;
      position: absolute;
      left: 0; top: 0;
    }
    .odin-arrow path {
      stroke: var(--gold);
      stroke-width: 3.2;
      fill: none;
    }
    .odin-subtitle {
      font-size: 1.16em;
      font-weight: 400;
      color: var(--navy);
      margin: 0 0 24px 0;
      letter-spacing: .02em;
      opacity: 0.88;
      text-align: center;
      text-shadow: 0 1px 0 #fff8;
    }
    .odin-chat-shell {
      background: var(--bubble);
      width: 92%;
      max-width: 640px;
      margin: 0 auto 0 auto;
      border-radius: 18px;
      box-shadow: 0 4px 28px 0 rgba(41,55,78,0.06);
      padding: 0 0 24px 0;
      min-height: 320px;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .odin-user-bubble {
      color: var(--navy);
      font-weight: 700;
      background: linear-gradient(90deg, #eef0f4 80%, #e8eefa 100%);
      border-radius: 13px 13px 0 13px;
      padding: 10px 18px 10px 18px;
      margin: 18px 24px 10px 24px;
      align-self: flex-end;
      box-shadow: 0 2px 9px 0 #eaeef6;
      font-size: 1.11em;
      max-width: 80%;
      word-break: break-word;
      border-left: 3px solid var(--blue);
      transition: all .22s cubic-bezier(.9,.2,.2,1);
    }
    .odin-ai-bubble {
      background: #fcfaf4;
      border-radius: 14px 14px 14px 0;
      color: #222;
      font-size: 1.07em;
      padding: 18px 22px 14px 22px;
      margin: 10px 24px 10px 24px;
      max-width: 92%;
      align-self: flex-start;
      box-shadow: 0 2px 12px 0 #f0e5c3a0;
      border-left: 3.3px solid var(--accent);
      font-family: 'Outfit', 'Segoe UI', Arial, sans-serif;
      line-height: 1.55;
      font-weight: 430;
      transition: all .22s cubic-bezier(.6,.2,.2,1);
      word-break: break-word;
    }
    .odin-ai-bubble strong {
      color: var(--navy);
      font-weight: 800;
      letter-spacing: .02em;
    }
    .odin-ai-bubble em {
      color: var(--blue);
      font-style: normal;
      font-weight: 700;
    }
    .odin-highlight {
      color: var(--accent);
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .04em;
      font-size: 1.09em;
      margin: 12px 0 6px 0;
      display: inline-block;
    }
    .odin-legacy {
      color: var(--rune);
      font-weight: 700;
      letter-spacing: .03em;
    }
    .odin-pop {
      color: var(--gold);
      font-weight: 600;
      letter-spacing: .01em;
    }
    .odin-ai-bubble blockquote {
      border-left: 4px solid var(--rune);
      color: var(--blue);
      margin: 14px 0 12px 0;
      padding: 2px 0 2px 18px;
      font-style: italic;
      background: #f7fafd;
      border-radius: 6px;
      font-size: 0.97em;
      font-family: 'Outfit', sans-serif;
    }
    .odin-ai-bubble ul, .odin-ai-bubble ol {
      margin: 12px 0 12px 24px;
      padding: 0;
      font-size: 1em;
    }
    .odin-ai-bubble li {
      margin-bottom: 4px;
      color: #353535;
    }
    .odin-ai-bubble .odin-rune {
      font-family: 'Noto Sans Runic', 'Outfit', Arial, sans-serif;
      color: var(--rune);
      font-size: 1.2em;
      font-weight: 500;
      margin: 0 2px;
      letter-spacing: .18em;
    }
    /* Loader */
    #odin-loader {
      display: none;
      justify-content: center;
      align-items: center;
      position: absolute;
      left: 0; right: 0;
      top: 38%;
      margin: 0 auto;
      width: 82px;
      height: 48px;
      z-index: 6;
      background: none;
    }
    .loader-spinner {
      width: 46px; height: 46px;
      border-radius: 50%;
      border: 3.3px solid #ede6d2;
      border-top: 3.3px solid var(--rune);
      animation: spin 1.1s linear infinite;
      margin-right: 12px;
    }
    .rune-spin {
      font-family: 'Noto Sans Runic', 'Outfit', Arial, sans-serif;
      font-size: 1.7em;
      color: var(--accent);
      letter-spacing: .08em;
      margin-left: 2px;
      animation: rune-blink 1.2s linear infinite alternate;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes rune-blink { 0%{opacity:.7;} 100%{opacity:1;} }
    /* Input/form */
    .odin-chat-form {
      display: flex;
      align-items: stretch;
      gap: 12px;
      margin: 18px auto 0 auto;
      width: 96%;
      max-width: 650px;
      position: relative;
      z-index: 4;
    }
    .odin-input {
      flex: 1 1 auto;
      font-size: 1.14em;
      padding: 16px 22px;
      border-radius: 11px;
      border: 1.5px solid #e1e1e8;
      font-family: 'Outfit', Arial, sans-serif;
      color: var(--primary);
      background: #fff;
      outline: none;
      box-shadow: 0 1px 5px 0 #eaeaea0a;
      margin: 0;
      transition: border .16s;
    }
    .odin-input:focus {
      border: 1.5px solid var(--rune);
      box-shadow: 0 2px 9px 0 #c4d8fd1c;
    }
    .odin-send-btn {
      font-family: 'Outfit', Arial, sans-serif;
      font-size: 1.18em;
      font-weight: 700;
      letter-spacing: .07em;
      background: var(--send-bg);
      color: #fff;
      border: none;
      border-radius: 11px;
      padding: 0 38px;
      cursor: pointer;
      transition: background var(--transition), transform .13s;
      box-shadow: 0 2px 12px 0 #e5e9fa22;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 112px;
      min-height: 52px;
      position: relative;
      outline: none;
    }
    .odin-send-btn:hover,
    .odin-send-btn:focus {
      background: var(--send-bg-hover);
      transform: translateY(-2px) scale(1.04);
      color: #fff;
      box-shadow: 0 4px 26px 0 #d2def2;
    }
    .odin-send-btn svg {
      margin-right: 8px;
      font-size: 1.09em;
    }
    /* Audio controls */
    .audio-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      position: absolute;
      right: 16px;
      top: 54px;
      z-index: 8;
      user-select: none;
      opacity: 0.90;
    }
    .audio-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--gold);
      font-size: 1.58em;
      display: flex;
      align-items: center;
      transition: color 0.22s;
      border-radius: 6px;
      padding: 2px 8px;
    }
    .audio-btn:focus {
      outline: 2px solid var(--accent);
    }
    .volume-slider {
      width: 90px;
      accent-color: var(--accent);
      vertical-align: middle;
    }
    /* Footer */
    .valhalla-footer {
      margin: 24px auto 0 auto;
      color: #babdc9;
      font-size: 1.04em;
      text-align: center;
      opacity: .94;
      letter-spacing: .01em;
      padding: 0 6px 0 6px;
    }
    .valhalla-badge {
      display: inline-block;
      background: var(--accent);
      color: #fff;
      border-radius: 8px;
      font-size: 1.08em;
      font-weight: 600;
      margin-left: 4px;
      padding: 2px 14px;
      letter-spacing: .02em;
      opacity: .94;
    }
    @media (max-width: 800px) {
      .odin-header { font-size: 2em;}
      .odin-chat-shell {max-width:96vw;}
      .odin-card {width:99vw;}
      .odin-logo { width:77px; height:77px;}
      .rune-banner {font-size:1.25em;}
    }
    @media (max-width: 550px) {
      .valhalla-main {padding: 14px 0 6vw 0;}
      .odin-card {padding: 0 0 14px 0;}
      .odin-chat-shell {width:99vw; min-width:0;}
      .odin-header {font-size:1.26em;}
      .odin-subtitle {font-size:0.99em;}
      .odin-logo {width:59px; height:59px;}
      .rune-banner {font-size:0.82em;}
      .audio-controls {top:24px; right:6px;}
      .odin-send-btn {padding:0 17px; min-width:66px; min-height:41px;}
      .odin-input {font-size:0.98em; padding: 11px 10px;}
    }
  </style>
</head>
<body>
  <main class="valhalla-main">
    <section class="odin-card" aria-label="Odin AI Chat">
      <!-- Runes Banner -->
      <div class="rune-banner" aria-hidden="true">
         ·ö† ·ö± ·öæ ·ö® ·ö∫ ·õÅ ·õâ ·ö± ·õó ·õã ·õû
      </div>
      <!-- Odin Logo -->
      <img src="https://cdn.shopify.com/s/files/1/0620/9958/7203/files/6efec50e-7164-40e4-9957-a95c6e0b487c.png?v=1751061405" alt="Odin's gold logo" class="odin-logo" />
      <!-- Ask Odin Heading -->
      <div class="odin-header">
        ASK 
        <span class="odin-o" tabindex="0" aria-label="Odin's rune">
          <span class="odin-o-base">O</span>
          <span class="odin-o-rune" aria-hidden="true">&#5792;</span>
        </span>
        DIN
      </div>
      <div class="odin-underline" aria-hidden="true">
        <svg class="odin-arrow" width="236" height="14">
          <line x1="8" y1="12" x2="228" y2="12" stroke="#c9ab67" stroke-width="3" />
          <polygon points="228,6 236,12 228,18" fill="#c9ab67"/>
        </svg>
      </div>
      <div class="odin-subtitle">Wisdom, legacy, and Norse myth for the modern world</div>
      <!-- Audio controls -->
      <div class="audio-controls" aria-label="Meditation audio controls">
        <button class="audio-btn" id="audio-play-btn" title="Play/Pause meditation music" aria-label="Play or pause meditation music">
          <span id="audio-icon">&#119136;</span>
        </button>
        <input type="range" min="0" max="1" step="0.01" value="0.23" id="audio-volume" class="volume-slider" aria-label="Volume"/>
      </div>
      <!-- Chat UI -->
      <section class="odin-chat-shell" aria-live="polite">
        <div id="chat"></div>
        <!-- Loader -->
        <div id="odin-loader">
          <div class="loader-spinner"></div>
          <span class="rune-spin">&#5792; &#5815; &#5807; &#5809;</span>
        </div>
      </section>
      <!-- Chat Input -->
      <form class="odin-chat-form" id="odin-form" autocomplete="off" onsubmit="event.preventDefault(); sendMessage();">
        <input id="user-input" class="odin-input" type="text" maxlength="340" placeholder="Ask your question..." autocomplete="off" aria-label="Ask Odin a question" />
        <button class="odin-send-btn" id="send-btn" type="submit" aria-label="Send question to Odin">
          <svg width="26" height="26" viewBox="0 0 22 22" fill="none"><path d="M3 11L20 4L13 21L11 13L3 11Z" fill="white"/></svg>
          SEND
        </button>
      </form>
    </section>
    <footer class="valhalla-footer" aria-label="Site Footer">
      Powered by <span class="valhalla-badge">Valhalla‚Äôs Edge</span>
    </footer>
  </main>
  <!-- Meditation Music (Royalty-Free from Pixabay, can swap URL) -->
  <audio id="meditation-audio" preload="auto" loop src="https://cdn.pixabay.com/audio/2023/05/11/audio_146b5b86e2.mp3"></audio>
  <script>
    // --- Audio controls ---
    const audio = document.getElementById('meditation-audio');
    const audioBtn = document.getElementById('audio-play-btn');
    const audioIcon = document.getElementById('audio-icon');
    const audioVol = document.getElementById('audio-volume');
    let audioOn = false;
    audio.volume = audioVol.value;
    audioBtn.addEventListener('click', () => {
      audioOn = !audioOn;
      if(audioOn) { audio.play(); audioIcon.textContent = '‚è∏Ô∏è'; }
      else { audio.pause(); audioIcon.textContent = 'üéµ'; }
    });
    audioVol.addEventListener('input', () => { audio.volume = audioVol.value; });
    // --- Chat ---
    const chat = document.getElementById('chat');
    const loader = document.getElementById('odin-loader');
    function showLoader(show=true) { loader.style.display = show ? 'flex' : 'none'; }
    // --- Chat state ---
    async function sendMessage() {
      const input = document.getElementById('user-input');
      let userText = input.value.trim();
      if(!userText) return;
      // Render user bubble
      chat.innerHTML += `<div class="odin-user-bubble">You: ${userText}</div>`;
      input.value = '';
      chat.scrollTop = chat.scrollHeight;
      showLoader(true);
      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userText, threadId: null })
        });
        const data = await response.json();
        showLoader(false);
        if(data.reply) {
          chat.innerHTML += `<div class="odin-ai-bubble">${parseAIText(data.reply)}</div>`;
        } else if(data.error) {
          chat.innerHTML += `<div class="odin-ai-bubble">Odin: <em>ERROR</em> ‚Äî ${data.error}</div>`;
        } else {
          chat.innerHTML += `<div class="odin-ai-bubble">Odin: <em>(No response from Valhalla...)</em></div>`;
        }
      } catch(err) {
        showLoader(false);
        chat.innerHTML += `<div class="odin-ai-bubble">Odin: <em>(NETWORK ERROR: ${err.message})</em></div>`;
      }
      chat.scrollTop = chat.scrollHeight;
    }
    // --- Enter key send
    document.getElementById('user-input').addEventListener('keydown', (e) => {
      if(e.key==='Enter'){e.preventDefault(); sendMessage();}
    });
    // --- AI formatting helpers ---
    function parseAIText(txt) {
      // Headings (THE MYTH, THE MESSAGE, etc.)
      txt = txt.replace(/(THE MYTH|THE MESSAGE|THE MOVE|LEGACY ECHO|THE LESSON|THE CHALLENGE|THE CODE|THE RITUAL)/g, '<span class="odin-highlight">$1</span>');
      // Legacy echo
      txt = txt.replace(/(echoes?)/gi, '<span class="odin-legacy">$1</span>');
      // Odin pop (wisdom, courage, vision, etc.)
      txt = txt.replace(/\b(wisdom|boldness|resilience|adaptability|vision|endurance|focus)\b/gi, '<span class="odin-pop">$1</span>');
      // Bolded words (BOOK, BRAVE, VIKING)
      txt = txt.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
      // Italic
      txt = txt.replace(/\*([^*]+)\*/g, '<em>$1</em>');
      // Blockquotes ("> " lines)
      txt = txt.replace(/^&gt; (.*)$/gm, '<blockquote>$1</blockquote>');
      // Replace `[Rune]` with rune font
      txt = txt.replace(/\[rune:([^\]]+)\]/g, '<span class="odin-rune">$1</span>');
      return txt;
    }
  </script>
</body>
</html>
