<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Odin AI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Montserrat for clean text, UnifrakturCook for Norse accent -->
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', 'Georgia', serif;
      background: linear-gradient(135deg, #f6f6f6 0%, #e6e7ea 100%);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      /* Subtle clouds using background-image and blur filter */
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: "";
      position: fixed;
      z-index: 0;
      left: 0; top: 0; right: 0; bottom: 0;
      background: url('https://www.transparenttextures.com/patterns/clouds.png'), linear-gradient(135deg, #f7f7f8 70%, #e6e7ea 100%);
      opacity: 0.28;
      filter: blur(0.5px);
      pointer-events: none;
    }
    .chat-wrapper {
      position: relative;
      z-index: 1;
      max-width: 820px;
      width: 98vw;
      margin: 68px auto 36px auto;
      background: rgba(255,255,255,0.91);
      border-radius: 2.2em;
      box-shadow: 0 12px 48px 0 #2222, 0 1.5px 32px #bac4cd44, 0 2px 24px 0 #0001;
      padding: 2.2em 2em 2.1em 2em;
      border: 2.5px solid #d2d5d8;
      backdrop-filter: blur(6px) saturate(1.18);
      transition: box-shadow 0.5s cubic-bezier(.17,.67,.83,.67), transform 0.5s cubic-bezier(.12,.57,.88,1.18);
    }
    .chat-wrapper:hover, .chat-wrapper:focus-within {
      box-shadow: 0 24px 68px 0 #57667b38, 0 1.5px 32px #bac4cd66, 0 2px 24px 0 #0002, 0 8px 50px 8px #b3c5d412;
      transform: translateY(-6px) scale(1.015);
    }
    h1 {
      text-align: center;
      font-family: 'Montserrat', sans-serif;
      font-size: 2.45em;
      letter-spacing: 1.6px;
      color: #1a1a1a;
      font-weight: 700;
      margin-bottom: 0.45em;
      margin-top: 0.15em;
      position: relative;
      z-index: 2;
    }
    .norse-underline {
      width: 90px;
      height: 4.7px;
      margin: -18px auto 29px auto;
      background: linear-gradient(to right, #adadc7 0%, #363b47 100%);
      border-radius: 2.5px;
      filter: blur(0.4px);
      box-shadow: 0 0 16px #e5e8ed4b, 0 0 2px #21273320;
      opacity: 0.62;
    }
    #loader {
      display: none;
      text-align: center;
      margin: 1.2em 0 1.1em 0;
      color: #545457;
      font-style: italic;
      font-size: 1.16em;
      font-family: 'Montserrat', serif;
      letter-spacing: 0.02em;
      transition: opacity 0.34s;
    }
    .loader-rune {
      display: inline-block;
      font-family: 'UnifrakturCook', serif;
      font-size: 2em;
      color: #adadc7;
      margin-right: 8px;
      vertical-align: middle;
      filter: drop-shadow(0 0 8px #d2d6e6cc);
      animation: runespin 2.1s linear infinite;
    }
    @keyframes runespin {
      0% { transform: rotateY(0);}
      80% { filter: drop-shadow(0 0 16px #bfc5da66);}
      100% { transform: rotateY(360deg);}
    }
    .loader-dots::after {
      content: '';
      display: inline-block;
      width: 1em;
      text-align: left;
      animation: ellipsis steps(4,end) 1.15s infinite;
    }
    @keyframes ellipsis {
      to {
        width: 4em;
      }
    }
    .chat-box {
      height: 410px;
      overflow-y: auto;
      border-radius: 1.4em;
      padding: 1.0em 1.4em 1.2em 1.3em;
      background: rgba(246,247,250,0.98);
      margin-bottom: 1.6em;
      box-shadow: 0 0 14px #c7cde211, 0 0.5px 10px #7a7b8b11;
      border: 1.5px solid #e0e0ec;
      scroll-behavior: smooth;
      position: relative;
      transition: box-shadow 0.4s;
    }
    .msg {
      opacity: 0;
      animation: fadeIn 0.5s forwards;
      margin-bottom: 0.8em;
    }
    @keyframes fadeIn {
      from { opacity: 0;}
      to   { opacity: 1;}
    }
    .msg.user {
      color: #232528;
      background: linear-gradient(98deg, #f7f7f7 80%, #d9dde3 100%);
      border-radius: 10px 20px 16px 10px;
      padding: 0.75em 1.25em 0.8em 1.1em;
      font-weight: bold;
      margin: 0.7em 0 0.7em 36%;
      border-left: 3px solid #bfc5da;
      box-shadow: 1px 2px 14px #bfc5da13;
      word-break: break-word;
      font-size: 1.07em;
    }
    .msg.odin {
      color: #222;
      background: linear-gradient(99deg, #f9fafc 93%, #ececf1 100%);
      font-style: italic;
      border-left: 4px solid #222940;
      padding: 1em 1.15em 1em 1.24em;
      margin: 0.7em 32% 0.7em 0;
      border-radius: 18px 13px 13px 21px;
      box-shadow: 2px 4px 24px #bfc5da1a;
      word-break: break-word;
      transition: box-shadow 0.6s;
      position: relative;
      font-size: 1.08em;
      /* For fog animation overlay */
      overflow: visible;
    }
    /* Odin fog (desktop only, on hover) */
    .msg.odin:hover::before {
      content: '';
      pointer-events: none;
      position: absolute;
      left: -10%; right: -10%; top: -10%; bottom: -10%;
      z-index: 2;
      background: radial-gradient(circle at 60% 60%, #dce0ea44 36%, #f7fafb11 90%);
      opacity: 0.82;
      animation: fog-move 2.2s linear infinite alternate;
      filter: blur(9px) brightness(1.13);
    }
    @keyframes fog-move {
      from { background-position: 60% 60%;}
      to   { background-position: 40% 40%;}
    }
    .msg.odin h1, .msg.odin h2, .msg.odin h3, .msg.odin h4, .msg.odin h5, .msg.odin h6 {
      font-family: 'UnifrakturCook', serif;
      color: #232528;
      letter-spacing: 0.5px;
      margin: 0.7em 0 0.3em 0;
      text-shadow: 0 0 7px #e1e4ed1a;
      font-weight: 700;
    }
    .msg.odin ul, .msg.odin ol {
      margin: 0.75em 0 0.75em 1.7em;
    }
    .msg.odin strong {
      color: #232528;
      font-weight: 700;
      text-shadow: 0 0 4px #adadc744;
    }
    .msg.odin em {
      color: #222940;
      font-style: italic;
    }
    .input-area {
      display: flex;
      gap: 1em;
      margin-top: 1.1em;
      align-items: center;
    }
    .input-area input {
      flex: 1;
      padding: 1.11em;
      font-size: 1.1em;
      border: 2.2px solid #bfc5da;
      border-radius: 13px;
      background: #f6f8fa;
      outline: none;
      transition: border 0.23s, box-shadow 0.3s;
      box-shadow: 0 1.5px 10px #bfc5da19;
    }
    .input-area input:focus {
      border: 2.6px solid #222940;
      box-shadow: 0 0 8px #adadc7;
    }
    .input-area button {
      padding: 1.08em 2.15em;
      font-size: 1.11em;
      background: linear-gradient(to right, #222940, #adadc7);
      color: #fff;
      border: none;
      border-radius: 13px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 1.5px 10px #bfc5da19;
      letter-spacing: 0.09em;
      transition: background 0.3s, box-shadow 0.3s;
      font-family: inherit;
    }
    .input-area button:hover {
      background: linear-gradient(to right, #363b47, #f6f6f6 100%);
      box-shadow: 0 6px 16px #adadc7a1;
      color: #222940;
    }
    @media (max-width: 600px) {
      .chat-wrapper { padding: 0.4em 1.5vw; }
      .chat-box { height: 250px;}
      h1 { font-size: 1.48em;}
      .norse-underline { width: 60px;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="chat-wrapper">
    <h1>Ask Odin</h1>
    <div class="norse-underline"></div>
    <div id="chat" class="chat-box"></div>
    <div id="loader">
      <span class="loader-rune">áš¨</span>
      Odin is searching the Well of Wisdom<span class="loader-dots">...</span>
    </div>
    <div class="input-area">
      <input id="user-input" type="text" placeholder="Ask your question..." onkeydown="if(event.key==='Enter'){sendMessage()}" autocomplete="off" />
      <button onclick="sendMessage()">SEND</button>
    </div>
  </div>
<script>
  async function sendMessage() {
    const input = document.getElementById('user-input');
    const chat = document.getElementById('chat');
    const loader = document.getElementById('loader');
    const userText = input.value.trim();
    if (!userText) return;

    // Always use a new thread (no memory)
    let threadId = null;
    localStorage.removeItem('odinThreadId'); // just in case

    chat.innerHTML += `<div class="msg user">You: ${userText}</div>`;
    input.value = '';
    chat.scrollTop = chat.scrollHeight;

    // Show loader
    loader.style.display = 'block';

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ message: userText, threadId })
      });

      const data = await response.json();

      // Hide loader
      loader.style.display = 'none';

      if (data.reply) {
        chat.innerHTML += `<div class="msg odin">${marked.parse(data.reply)}</div>`;
      } else if (data.error) {
        chat.innerHTML += `<div class="msg odin">Odin: ERROR - ${data.error}</div>`;
      } else {
        chat.innerHTML += `<div class="msg odin">Odin: (No response from Valhalla...)</div>`;
      }
    } catch (err) {
      loader.style.display = 'none';
      console.error(err);
      chat.innerHTML += `<div class="msg odin">Odin: (NETWORK ERROR: ${err.message})</div>`;
    }

    chat.scrollTop = chat.scrollHeight;
  }
</script>
</body>
</html>
