<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Odin AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="OdinAI: Wisdom, legacy, and Norse myth for the modern world"/>
  <link rel="icon" href="https://cdn.shopify.com/s/files/1/0620/9958/7203/files/ChatGPT_Image_Jun_27_2025_02_47_18_PM.png?v=1751060934">
  <!-- Inter (modern sans), Montserrat (for semi-runic feel) -->
  <link href="https://fonts.googleapis.com/css?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
  <!-- Material Icons (for send, audio) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    html, body {
      background: radial-gradient(ellipse at center 30vh, #f7f9fc 60%, #e8ecf3 100%);
      min-height: 100vh;
      font-family: 'Inter', 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #17181c;
    }
    body { overflow-x: hidden; }
    .odin-main {
      max-width: 480px;
      margin: 48px auto 0 auto;
      background: #fff;
      border-radius: 32px;
      box-shadow: 0 16px 60px #1112  , 0 1.5px 0 #e3d6b3 inset;
      position: relative;
      z-index: 2;
      padding: 40px 0 32px 0;
      animation: floatIn 1.3s cubic-bezier(.26,.87,.42,1.05);
    }
    @keyframes floatIn {
      0% { transform:translateY(48px) scale(.97); opacity:0; }
      70% { opacity:1; }
      100% { transform:translateY(0) scale(1); opacity:1; }
    }
    .odin-logo-wrap {
      text-align: center;
      margin-top: -66px;
      margin-bottom: 10px;
    }
    .odin-logo {
      width: 88px; height: 88px;
      border-radius: 50%;
      box-shadow: 0 3px 24px #0006;
      background: #18120e;
      border: 4px solid #dbc078;
      transition: box-shadow .3s;
      position: relative;
      z-index: 3;
    }
    .odin-logo:hover {
      box-shadow: 0 8px 32px #000c, 0 0 24px #dbc07877;
      transition: box-shadow .2s;
    }
    /* Runes behind logo/title */
    .rune-bg {
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      text-align: center;
      color: #d4d4d7;
      font-size: 2rem;
      letter-spacing: 1.5rem;
      opacity: 0.24;
      font-weight: 900;
      margin-top: -22px;
      margin-bottom: 0;
      user-select:none;
      pointer-events:none;
    }
    /* OdinAI Title */
    .odin-title {
      text-align: center;
      margin: 10px 0 0 0;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: 900;
      font-size: 2.7rem;
      letter-spacing: .08em;
      color: #15141A;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
    }
    .odin-o {
      display: inline-block;
      transition: color .25s;
      font-size: 2.6rem;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      color: #a21927;
      position: relative;
      cursor: pointer;
    }
    .odin-o .odin-o-rune {
      position: absolute; left:0; top:0;
      width:100%; height:100%;
      font-family: inherit;
      font-size: inherit;
      color: #a21927;
      opacity:0; pointer-events:none;
      transition: opacity .22s;
      text-shadow: 0 2px 6px #0006;
      letter-spacing: 0;
    }
    .odin-o:hover .odin-o-rune { opacity:1; }
    .odin-o:hover .odin-o-base { opacity:0; }
    .odin-o .odin-o-base { opacity:1; transition: opacity .22s; }
    /* Underline arrow */
    .odin-title-underline {
      margin: 0 auto 10px auto;
      display: block;
      width: 240px; height: 21px;
    }
    /* Tagline */
    .odin-tagline {
      text-align: center;
      margin: 0 auto 24px auto;
      color: #898988;
      font-size: 1.04rem;
      font-weight: 400;
      letter-spacing: .06em;
      font-family: 'Inter', Arial, sans-serif;
    }
    /* Chat container */
    .odin-chat-frame {
      width: 96%;
      margin: 0 auto;
      background: #f8f6eecc;
      border-radius: 16px;
      box-shadow: 0 2px 16px #dbc07813;
      border: 2.5px solid #ede4c8;
      position: relative;
      padding: 0;
      margin-bottom: 24px;
      min-height: 200px;
      max-height: 375px;
      overflow-y: auto;
      transition: box-shadow .18s;
    }
    .odin-chat-frame:focus-within, .odin-chat-frame:hover {
      box-shadow: 0 8px 32px #aab7c940;
      border-color: #dac273;
    }
    .odin-user-bubble {
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: 700;
      color: #283963;
      background: #f5f8fc;
      border-left: 5px solid #6e93ce;
      padding: 14px 18px 10px 18px;
      margin: 18px 0 4px 0;
      border-radius: 11px 16px 13px 16px;
      font-size: 1.12rem;
      max-width: 94%;
    }
    .odin-ai-bubble {
      font-family: 'Georgia', 'serif';
      font-size: 1.08rem;
      background: #faf9f5;
      color: #25231e;
      border-left: 5px solid #b8a05d;
      padding: 13px 22px 13px 20px;
      border-radius: 14px 13px 15px 17px;
      margin: 2px 0 18px 0;
      box-shadow: 0 1px 4px #e9e2be20;
      max-width: 98%;
      line-height: 1.57;
      word-break: break-word;
      transition: box-shadow .15s;
      font-variant-ligatures: common-ligatures;
    }
    .odin-ai-bubble strong,
    .odin-ai-bubble .odin-heading {
      color: #314072;
      font-weight: bold;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      letter-spacing: .01em;
    }
    .odin-ai-bubble .odin-highlight {
      color: #98713a;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: 700;
      letter-spacing: .06em;
      font-size: 1.05em;
    }
    .odin-ai-bubble em, .odin-ai-bubble .odin-pop {
      color: #5a7ca5;
      font-style: italic;
      font-family: 'Inter', Arial, sans-serif;
    }
    .odin-ai-bubble .odin-legacy {
      color: #b8942a;
      font-weight: bold;
    }
    .odin-ai-bubble .odin-rune {
      font-family: 'Montserrat', Arial, sans-serif;
      letter-spacing: 0.15em;
      color: #adc;
      font-size: 1.09em;
    }
    /* Loader */
    .odin-loader {
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      color: #98713a;
      font-size: 1.16rem;
      margin: 16px 0 8px 0;
      font-weight: bold;
      min-height: 30px;
      letter-spacing: .04em;
      user-select:none;
      gap: 8px;
      opacity: .93;
    }
    .rune-spin {
      animation: spin 1.8s linear infinite;
      font-size: 1.68em;
      margin-right: 7px;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    /* Input area */
    .input-area {
      width: 94%;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .input-area input[type="text"] {
      flex: 1;
      padding: 1.13em .9em 1.13em 1em;
      border: 2px solid #dac273;
      border-radius: 12px;
      font-size: 1.13rem;
      font-family: 'Inter', Arial, sans-serif;
      outline: none;
      transition: border .18s, box-shadow .15s;
      background: #fdfbf6;
      color: #222;
      box-shadow: 0 1px 6px #c8ad6444 inset;
    }
    .input-area input[type="text"]:focus {
      border-color: #9bb0c9;
      box-shadow: 0 2px 12px #adc7e220;
    }
    .input-area button {
      background: linear-gradient(90deg, #b8a05d 30%, #314072 88%);
      color: #fff;
      border: none;
      border-radius: 11px;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      font-weight: bold;
      font-size: 1.18rem;
      padding: 1em 2.1em;
      box-shadow: 0 2px 9px #adc7e233;
      cursor: pointer;
      transition: box-shadow .2s, background .21s;
      letter-spacing: .07em;
      outline: none;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .input-area button:hover {
      background: linear-gradient(90deg, #314072 10%, #b8a05d 80%);
      box-shadow: 0 5px 18px #31407220;
    }
    .audio-toggle {
      background: none;
      border: none;
      color: #b8a05d;
      font-size: 1.93em;
      margin-left: 8px;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity .18s;
      outline: none;
      padding: 0;
      line-height: 1;
    }
    .audio-toggle[aria-pressed="true"] { color: #314072; opacity:1;}
    .audio-toggle:hover, .audio-toggle:focus { opacity: 1; color: #b8a05d; }
    /* Footer */
    .valhalla-footer {
      text-align: center;
      color: #b8a05d;
      margin: 32px auto 0 auto;
      font-size: 1.06rem;
      letter-spacing: .04em;
      font-family: 'Montserrat', 'Inter', Arial, sans-serif;
      opacity: .77;
      padding-bottom: 18px;
    }
    .valhalla-badge {
      background: #f4eacb;
      color: #314072;
      font-weight: bold;
      border-radius: 7px;
      padding: 2px 13px;
      margin-left: 4px;
      font-size: 1.04em;
      letter-spacing: .06em;
      border: 1.5px solid #dac273;
      box-shadow: 0 2px 7px #dac27333;
      vertical-align: middle;
      display: inline-block;
    }
    @media (max-width: 700px) {
      .odin-main { max-width:98vw; border-radius:16px; }
      .odin-logo { width: 60px; height: 60px; }
      .odin-title { font-size: 2.05rem;}
      .odin-title-underline { width: 130px;}
      .rune-bg {font-size:1.15rem;}
      .odin-chat-frame {max-height:260px;}
      .odin-ai-bubble { font-size:1.02rem;}
      .odin-user-bubble { font-size:1rem;}
    }
  </style>
</head>
<body>
  <div class="odin-main">
    <div class="odin-logo-wrap">
      <img src="https://cdn.shopify.com/s/files/1/0620/9958/7203/files/ChatGPT_Image_Jun_27_2025_02_47_18_PM.png?v=1751060934" class="odin-logo" alt="Odin Norse AI Logo" draggable="false" />
    </div>
    <div class="rune-bg" aria-hidden="true">
      ᚠᚱᚾᛊ ᚠᛁ ᚱᛉᚱ ᛗᚾᛉ
    </div>
    <div class="odin-title">
      ASK
      <span class="odin-o" tabindex="0">
        <span class="odin-o-base">O</span>
        <span class="odin-o-rune" aria-hidden="true">ᛟ</span>
      </span>
      DIN
    </div>
    <svg class="odin-title-underline" viewBox="0 0 228 18" fill="none">
      <path d="M10 9 H218" stroke="#b8a05d" stroke-width="4" stroke-linecap="round"/>
      <polygon points="218,9 209,4 209,14" fill="#b8a05d"/>
      <circle cx="10" cy="9" r="3.4" fill="#b8a05d"/>
    </svg>
    <div class="odin-tagline">Wisdom, legacy, and Norse myth for the modern world</div>
    <div class="odin-chat-frame" id="chat" aria-live="polite" aria-atomic="false"></div>
    <div class="odin-loader" id="odin-loader" style="display:none;">
      <span class="rune-spin">ᚨ</span>
      Odin is consulting the Well of Wisdom...
    </div>
    <form class="input-area" autocomplete="off" onsubmit="sendMessage();return false;">
      <input id="user-input" type="text" maxlength="600" placeholder="Ask your question..." aria-label="Type your question"/>
      <button type="submit"><span class="material-icons" style="vertical-align:middle;">send</span> SEND</button>
      <span id="audioToggle" class="audio-toggle material-icons" title="Toggle ambience" tabindex="0" role="button" aria-pressed="false">volume_up</span>
    </form>
  </div>
  <div class="valhalla-footer">
    Powered by <span class="valhalla-badge">Valhalla’s Edge</span>
  </div>
  <!-- Ambient rain audio (CC0, can swap to any URL you like) -->
  <audio id="odinAudio" loop preload="auto" src="https://cdn.pixabay.com/audio/2023/07/24/audio_146cd878fb.mp3" type="audio/mp3"></audio>
  <script>
    // Odin Chat Logic
    let threadId = null;
    const chatBox = document.getElementById('chat');
    const loader = document.getElementById('odin-loader');
    const input = document.getElementById('user-input');

    // Utility: Add Odin/user message
    function addMsg(content, type = 'odin') {
      let html = type === "user"
        ? `<div class="odin-user-bubble">${content}</div>`
        : `<div class="odin-ai-bubble">${content}</div>`;
      chatBox.innerHTML += html;
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Odin response parsing: bold, headings, runes, color-pops, legacy, markdown
    function parseOdin(text) {
      // Headings
      text = text.replace(/(?:\*\*|__)(.*?)\1?(?:\*\*|__)/g, `<span class="odin-heading">$1</span>`);
      // Strong
      text = text.replace(/\*\*(.*?)\*\*/g, `<strong>$1</strong>`);
      // Highlighted/legacy echoes (words like echo, legacy, etc)
      text = text.replace(/\b(legacy|echo|wisdom|truth)\b/gi, `<span class="odin-legacy">$1</span>`);
      // Pop terms (italic or em)
      text = text.replace(/\*(.*?)\*/g, `<em class="odin-pop">$1</em>`);
      // Blue highlight for THE MYTH, THE MESSAGE, THE MOVE
      text = text.replace(/(THE MYTH|THE MESSAGE|THE MOVE|THE LEGACY|LEGACY ECHO|THE SAGA)/g, `<span class="odin-highlight">$1</span>`);
      // Runes
      text = text.replace(/`([ᚠ-ᛟ]{2,})`/g, `<span class="odin-rune">$1</span>`);
      // Bullets
      text = text.replace(/^\s*[\-\*] (.+)$/gm, '<li>$1</li>');
      // Blockquotes
      text = text.replace(/^\s*\>\s?(.*)$/gm, '<blockquote>$1</blockquote>');
      // Line breaks
      text = text.replace(/\n{2,}/g, '<br><br>');
      return text;
    }

    // Loader with animated runes
    const runes = ['ᚠ','ᚢ','ᚦ','ᚨ','ᚱ','ᚲ','ᚷ','ᚹ','ᚺ','ᚾ','ᛁ','ᛃ','ᛇ','ᛈ','ᛉ','ᛋ','ᛏ','ᛒ','ᛖ','ᛗ','ᛚ','ᛜ','ᛞ','ᛟ'];
    let runeInterval, runeIdx=0;
    function showLoader() {
      loader.style.display = "flex";
      runeIdx=0;
      loader.querySelector('.rune-spin').textContent = runes[0];
      runeInterval = setInterval(()=>{
        runeIdx = (runeIdx+1)%runes.length;
        loader.querySelector('.rune-spin').textContent = runes[runeIdx];
      }, 155);
    }
    function hideLoader() {
      loader.style.display = "none";
      if(runeInterval) clearInterval(runeInterval);
    }

    // Chat submission
    async function sendMessage() {
      const userText = input.value.trim();
      if (!userText) return;
      addMsg("You: <b>" + userText + "</b>", "user");
      input.value = '';
      showLoader();
      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ message: userText, threadId: null }) // always reset thread for stateless for now
        });
        const data = await response.json();
        hideLoader();
        if (data.reply) {
          addMsg("Odin: " + parseOdin(data.reply), "odin");
        } else if (data.error) {
          addMsg(`<span style="color:#a21927;">ERROR: ${data.error}</span>`, "odin");
        } else {
          addMsg(`<span style="color:#ad4d24;">(No response from Valhalla...)</span>`, "odin");
        }
      } catch (err) {
        hideLoader();
        addMsg(`<span style="color:#ad4d24;">(NETWORK ERROR: ${err.message})</span>`, "odin");
      }
    }

    // Enter key
    input.addEventListener('keydown', function(e){
      if (e.key === 'Enter') { e.preventDefault(); sendMessage(); }
    });

    // Odin O: hover = rune swap
    document.querySelector('.odin-o').addEventListener('mouseenter',function(){
      this.querySelector('.odin-o-rune').style.opacity=1;
      this.querySelector('.odin-o-base').style.opacity=0;
    });
    document.querySelector('.odin-o').addEventListener('mouseleave',function(){
      this.querySelector('.odin-o-rune').style.opacity=0;
      this.querySelector('.odin-o-base').style.opacity=1;
    });
    // Keyboard accessibility for Odin O rune swap
    document.querySelector('.odin-o').addEventListener('focus',function(){
      this.querySelector('.odin-o-rune').style.opacity=1;
      this.querySelector('.odin-o-base').style.opacity=0;
    });
    document.querySelector('.odin-o').addEventListener('blur',function(){
      this.querySelector('.odin-o-rune').style.opacity=0;
      this.querySelector('.odin-o-base').style.opacity=1;
    });

    // Audio ambience logic
    const audio = document.getElementById('odinAudio');
    const audioToggle = document.getElementById('audioToggle');
    let audioOn = false;
    audioToggle.onclick = function(){
      audioOn = !audioOn;
      audioToggle.setAttribute('aria-pressed', audioOn ? "true" : "false");
      if(audioOn) { audio.volume=0.26; audio.play(); }
      else audio.pause();
    };
    audioToggle.addEventListener('keydown',function(e){
      if(e.key==='Enter'||e.key===' '){audioToggle.click();}
    });
    // (Optional) Start with sound ON:
    // window.onload = () => { audioToggle.click(); };

    // Mobile autofocus hack
    window.onload = () => { setTimeout(()=>input.focus(),100); };
  </script>
</body>
</html>
